{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block body_class %}normal-background{% endblock %}

{% block content %}

{% if loggedIn %}
{% comment %}<div class="container">
	<form method="GET">
		{{ filter.form }}
		<button type="submit" class="btn btn-primary">Search</button>
	</form>
	<br>
</div>

<div>
    {{ shuttle_time}}
</div>
{% endcomment %}


<!-- THE LOOP DISPLAYING TEE TIMES STARTS HERE -->
<div class='centered'>
    <br><br><br>
    <div class="centered">
        <h2 class='page-heading'>Join a Ride</h2>
        <p>
            All of the rides shown below are open to join, just go ahead and sign up for one and your seat<br>
            will be reserved! Click the associated link for each ride to view more info and to sign up.<br>
            Note: All rides are round-trip, see 'More Info/Join' for travel details.<br>
            ________________________________________________
        </p>
        <br>

        
    </div>
    <table class='table table-striped table-dark table-hover' id="tee-time-table">
        <thead class='thead-dark'>
        <tr>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Route/Course</th>
                    <th>Current Riders</th>
                    <th>Total Price</th>
                    <th>Available Seats</th>
                    <th>Request</th>
        </tr>
    </thead>
{% for tee_time_group in shuttle_times %}
    
        {% for tee in tee_time_group.shuttles.all %}
            {% if not tee.is_full %}
                <tr>
                <td>{{ tee.shuttle_time_date }}</td>
                <td>{{ tee.shuttle_time }}</td>
                <td>{{ tee.shuttle_destination }}</td>
                <td> |
                {% for us in tee.shuttle_users.all %}
                    {{ us.user.username }} |
                {% endfor %}
                </td>
                <td>${{ tee.shuttle_price }}</td>
                <td>{{ -1|add:tee.shuttle_availability }}</td>
                <td>

                    <!-- Should eventually ove this computation out of the tempalte -->
                    {% if user in tee.shuttle_users.all %}
                        <p>Already joined ride!</p>
                    {% else %}
                        <a href="{% url 'bt_site:add_friendteetime' tee.id %}">More Info/Join</a>
                    {% endif %}
                </td>
                </tr>
            {% endif %}
        {% endfor %}

{% endfor %}
</table>
</div>

{% else %}
<h1 class='centered'>You must log in or sign up to view posted tee times!</h1>
{% endif %}

{% endblock %}